<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rclean • rOpenSci: Rclean</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- ropensci --><link href="../ropensci.css" rel="stylesheet">
<meta property="og:title" content="Rclean">
<meta property="og:description" content="Rclean">
<meta name="twitter:card" content="summary">
<!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
<!-- End Matomo Code -->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a href="https://ropensci.org"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
        <a class="navbar-brand" href="../index.html"><i>Rclean <small>v1.1.8</small></i></a>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/Rclean.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/MKLau/Rclean/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right docsearch" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Rclean</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/MKLau/Rclean/blob/master/vignettes/Rclean.rmd"><code>vignettes/Rclean.rmd</code></a></small>
      <div class="hidden name"><code>Rclean.rmd</code></div>

    </div>

    
    
<!-- \VignetteEngine{knitr::knitr} -->
<!-- https://bookdown.org/yihui/rmarkdown/r-package-vignette.html -->
<p>Written with research scientists in mind, <a href="https://cran.r-project.org/web/packages/Rclean/">Rclean</a>’s primary function provides a simple way to isolate the minimal code you need to produce specific results, such as a statistical table or a figure. By analyzing the relationships among objects and functions, large and/or complicated analytical scripts can be paired down to the essentials. This can aid in debugging and re-factoring code and help to make scientific projects more robust and easily shared.</p>
<div id="quick-start-guide" class="section level1">
<h1 class="hasAnchor">
<a href="#quick-start-guide" class="anchor"></a>Quick-start Guide</h1>
<p>You can install <a href="https://cran.r-project.org/web/packages/Rclean/">Rclean</a> from <em>CRAN</em>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"Rclean"</span><span class="op">)</span></code></pre></div>
<p>You can install the most up to date version using <a href="https://github.com/hadley/devtools">devtools</a>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"MKLau/Rclean"</span><span class="op">)</span></code></pre></div>
<p>Once installed, per usual R practice, just load the <em>Rclean</em> package with:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MKLau/Rclean">Rclean</a></span><span class="op">)</span></code></pre></div>
<p><a href="https://cran.r-project.org/web/packages/Rclean/">Rclean</a> usage is simple. Just run the <code>clean</code> function with the file path to a script as the input. We can use an example script that is included with the package:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">script</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"example"</span>, 
                      <span class="st">"simple_script.R"</span>, 
                      package <span class="op">=</span> <span class="st">"Rclean"</span><span class="op">)</span></code></pre></div>
<p>Here’s a quick look at the code:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span><span class="op">(</span><span class="va">script</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "## Make a data frame"                             
##  [2] "mat &lt;- matrix(rnorm(400), nrow = 100)"            
##  [3] "dat &lt;- as.data.frame(mat)"                        
##  [4] "dat[, \"V2\"] &lt;- dat[, \"V2\"] + runif(nrow(dat))"
##  [5] "dat[, \"V5\"] &lt;- gl(10, 10)"                      
##  [6] "## Conduct some analyses"                         
##  [7] "fit12 &lt;- lm(V1 ~ V2, data = dat)"                 
##  [8] "fit13 &lt;- lm(V1 ~ V3, data = dat)"                 
##  [9] "fit14 &lt;- lm(V1 ~ V4, data = dat)"                 
## [10] "fit15.aov &lt;- aov(V1 ~ V2 + V5, data = dat)"       
## [11] "## Summarize analyses"                            
## [12] "summary(fit15.aov)"                               
## [13] "tab.12 &lt;- summary(fit12)"                         
## [14] "tab.13 &lt;- summary(fit13)"                         
## [15] "tab.14 &lt;- summary(fit14)"                         
## [16] "tab.15 &lt;- append(fit15.aov, tab.14)"              
## [17] "## Conduct a calculation"                         
## [18] "dat &lt;- 25 + 2"                                    
## [19] "dat[2] &lt;- 10"                                     
## [20] "out &lt;- dat * 2"</code></pre>
<p>You can get a list of the variables found in an object with <code>get_vars</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_vars.html">get_vars</a></span><span class="op">(</span><span class="va">script</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "mat"       "dat"       "fit12"     "fit13"     "fit14"     "fit15.aov"
##  [7] "tab.12"    "tab.13"    "tab.14"    "tab.15"    "out"</code></pre>
<p>Sometimes for more complicated scripts, it can be helpful to see a network graph showing the interdependencies of variables. <code>code_graph</code> will produce a network diagram showing which lines of code produce or use which variables (e.g. 1 -&gt; “out”):</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/code_graph.html">code_graph</a></span><span class="op">(</span><span class="va">script</span><span class="op">)</span></code></pre></div>
<p><img src="Rclean_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>Now, we can pick the result we want to focus on for cleaning:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/clean.html">clean</a></span><span class="op">(</span><span class="va">script</span>, <span class="st">"tab.15"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Could not use colored = TRUE, as the package prettycode is not
## installed. Please install it if you want to see colored output or see `?
## print.vertical` for more information.</code></pre>
<pre><code>## mat &lt;- matrix(rnorm(400), nrow = 100)
## dat &lt;- as.data.frame(mat)
## dat[, "V2"] &lt;- dat[, "V2"] + runif(nrow(dat))
## dat[, "V5"] &lt;- gl(10, 10)
## fit14 &lt;- lm(V1 ~ V4, data = dat)
## fit15.aov &lt;- aov(V1 ~ V2 + V5, data = dat)
## tab.14 &lt;- summary(fit14)
## tab.15 &lt;- append(fit15.aov, tab.14)
## dat &lt;- 25 + 2
## dat[2] &lt;- 10</code></pre>
<p>We can also select several variables at the same time:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my.vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"tab.12"</span>, <span class="st">"tab.15"</span><span class="op">)</span>
<span class="fu"><a href="../reference/clean.html">clean</a></span><span class="op">(</span><span class="va">script</span>, <span class="va">my.vars</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Could not use colored = TRUE, as the package prettycode is not
## installed. Please install it if you want to see colored output or see `?
## print.vertical` for more information.</code></pre>
<pre><code>## mat &lt;- matrix(rnorm(400), nrow = 100)
## dat &lt;- as.data.frame(mat)
## dat[, "V2"] &lt;- dat[, "V2"] + runif(nrow(dat))
## dat[, "V5"] &lt;- gl(10, 10)
## fit12 &lt;- lm(V1 ~ V2, data = dat)
## fit14 &lt;- lm(V1 ~ V4, data = dat)
## fit15.aov &lt;- aov(V1 ~ V2 + V5, data = dat)
## tab.12 &lt;- summary(fit12)
## tab.14 &lt;- summary(fit14)
## tab.15 &lt;- append(fit15.aov, tab.14)
## dat &lt;- 25 + 2
## dat[2] &lt;- 10</code></pre>
<p>While just taking a look at the simplified code can be very helpful, you can also save the code for later use or sharing (e.g. creating a reproducible example for getting help) with <code>keep</code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my.code</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clean.html">clean</a></span><span class="op">(</span><span class="va">script</span>, <span class="va">my.vars</span><span class="op">)</span>
<span class="fu"><a href="../reference/keep.html">keep</a></span><span class="op">(</span><span class="va">my.code</span>, file <span class="op">=</span> <span class="st">"results_tables.R"</span><span class="op">)</span></code></pre></div>
<p>If you would like to copy your code to your clipboard to copy-paste, you can do that by not specifying a file path. You can now paste the simplified as needed, such as into another script file or a help forum thread.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/keep.html">keep</a></span><span class="op">(</span><span class="va">my.code</span><span class="op">)</span></code></pre></div>
</div>
<div id="some-thoughts-on-the-need-for-code-cleaning" class="section level1">
<h1 class="hasAnchor">
<a href="#some-thoughts-on-the-need-for-code-cleaning" class="anchor"></a>Some Thoughts on the Need for “Code Cleaning”</h1>
<p>At it’s root R is a statistical programming language. That is, it was designed for use in analytical workflows. As such, the majority of the R community is focused on producing code for idiosyncratic projects that are results oriented. Also, R’s design is intentionally at a level that abstracts many aspects of programming that would otherwise act as a barrier to entry for many users. This is good in that there are many people who use R to their benefit with little to no formal training in computer science or software engineering. However, these same users are also frequently frustrated by code that is fragile, buggy and complicated enough to quickly become obtuse even to themselves in a very short amount of time. In addition, when scripts take an extremely long time to execute, being able to reduce unnecessary analyses can help increase computation efficiency.</p>
<p>More often then not, when someone is writing an R script, they are intent on getting a set of results. This set of results is always a subset of a much larger set of possible ways to explore a dataset, as there are many statistical approaches and tests, let alone ways to create visualizations and other representations of patterns in data. This commonly leads to lengthy, complicated scripts from which researchers manually subset results, but never refactor (i.e. reduce to the final subset). In part, this is enabled by a lack of a proper version control system, and in order to record their process and not lose work, the entire process remains in a single or several scripts. Although <em>Rclean</em> is not designed to fix the latter, it can help with the former issue, once an appropriate versioning system is adopted (e.g. git or subversion).</p>
</div>
<div id="example-cleaning-a-long-script" class="section level1">
<h1 class="hasAnchor">
<a href="#example-cleaning-a-long-script" class="anchor"></a>Example: Cleaning a Long Script</h1>
<p>Conducting analyses is challenging in that it requires thinking about multiple concepts at the same time. What did I measure? What analyses are relevant to them? Do I need to transform the data? How do I go about managing the data given how they were entered? What’s the code for the analysis I want to run? And so on. Data analysis can be messy and complicated, so it’s no wonder that code reflects this. And this is a reason why having a way to isolate code based on variables can be valuable.</p>
<p>The following is an example of a script that has some complications. As you can see, although the script is not extremely long, it’s long enough to make it frustrating to visualize it in its entirety and pick through it.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">script.long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"example"</span>, 
                           <span class="st">"long_script.R"</span>, 
                           package <span class="op">=</span> <span class="st">"Rclean"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span><span class="op">(</span><span class="va">script.long</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "library(stats)"                                                          
##  [2] "x &lt;- 1:100"                                                              
##  [3] "x &lt;- log(x)"                                                             
##  [4] "x &lt;- x * 2"                                                              
##  [5] "x &lt;- lapply(x, rep, times = 4)"                                          
##  [6] "### This is a note that I made for myself."                              
##  [7] "### Next time, make sure to use a different analysis."                   
##  [8] "### Also, check with someone about how to run some other analysis."      
##  [9] "x &lt;- do.call(cbind, x)"                                                  
## [10] ""                                                                        
## [11] "### Now I'm going to create a different variable."                       
## [12] "### This is the best variable the world has ever seen."                  
## [13] ""                                                                        
## [14] "x2 &lt;- sample(10:1000, 100)"                                              
## [15] "x2 &lt;- lapply(x2, rnorm)"                                                 
## [16] ""                                                                        
## [17] "### Wait, now I had another thought about x that I want to work through."
## [18] ""                                                                        
## [19] "x &lt;- x * 2"                                                              
## [20] "colnames(x) &lt;- paste0(\"X\", seq_len(ncol(x)))"                          
## [21] "rownames(x) &lt;- LETTERS[seq_len(nrow(x))]"                                
## [22] "x &lt;- t(x)"                                                               
## [23] "x[, \"A\"] &lt;- sqrt(x[, \"A\"])"                                          
## [24] ""                                                                        
## [25] "for (i in seq_along(colnames(x))) {"                                     
## [26] "    set.seed(17)"                                                        
## [27] "    x[, i] &lt;- x[, i] + runif(length(x[, i]), -1, 1)"                     
## [28] "}"                                                                       
## [29] ""                                                                        
## [30] "### Ok. Now I can get back to x2."                                       
## [31] "### Now I just need to check out a bunch of stuff with it."              
## [32] ""                                                                        
## [33] "lapply(x2, length)[1]"                                                   
## [34] "max(unlist(lapply(x2, length)))"                                         
## [35] "range(unlist(lapply(x2, length)))"                                       
## [36] "head(x2[[1]])"                                                           
## [37] "tail(x2[[1]])"                                                           
## [38] ""                                                                        
## [39] "## Now, based on that stuff, I need to subset x2."                       
## [40] ""                                                                        
## [41] "x2 &lt;- lapply(x2, function(x) x[1:10])"                                   
## [42] ""                                                                        
## [43] "## And turn it into a matrix."                                           
## [44] "x2 &lt;- do.call(rbind, x2)"                                                
## [45] ""                                                                        
## [46] "## Now, based on x2, I need to create x3."                               
## [47] "x3 &lt;- x2[, 1:2]"                                                         
## [48] "x3 &lt;- apply(x3, 2, round, digits = 3)"                                   
## [49] ""                                                                        
## [50] "## Oh wait! Another thought about x."                                    
## [51] ""                                                                        
## [52] "x[, 1] &lt;- x[, 1] * 2 + 10"                                               
## [53] "x[, 2] &lt;- x[, 1] + x[, 2]"                                               
## [54] "x[, \"A\"] &lt;- x[, \"A\"] * 2"                                            
## [55] ""                                                                        
## [56] "## Now, I want to run an analysis on two variables in x2 and x3."        
## [57] ""                                                                        
## [58] "fit.23 &lt;- lm(x2 ~ x3, data = data.frame(x2[, 1], x3[, 1]))"              
## [59] "summary(fit.23)"                                                         
## [60] ""                                                                        
## [61] "## And while I'm at it, I should do an analysis on x."                   
## [62] ""                                                                        
## [63] "x &lt;- data.frame(x)"                                                      
## [64] "fit.xx &lt;- lm(A~B, data = x)"                                             
## [65] "summary(fit.xx)"                                                         
## [66] "shapiro.test(residuals(fit.xx))"                                         
## [67] ""                                                                        
## [68] "## Ah, it looks like I should probably transform A."                     
## [69] "## Let's try that."                                                      
## [70] "fit_sqrt_A &lt;- lm(I(sqrt(A))~B, data = x)"                                
## [71] "summary(fit_sqrt_A)"                                                     
## [72] "shapiro.test(residuals(fit_sqrt_A))"                                     
## [73] ""                                                                        
## [74] "## Looks good!"                                                          
## [75] ""                                                                        
## [76] "## After that. I came back and ran another analysis with "               
## [77] "## x2 and a new variable."                                               
## [78] ""                                                                        
## [79] "z &lt;- c(rep(\"A\", nrow(x2) / 2), rep(\"B\", nrow(x2) / 2))"              
## [80] "fit_anova &lt;- aov(x2 ~ z, data = data.frame(x2 = x2[, 1], z))"            
## [81] "summary(fit_anova)"</code></pre>
<p>So, let’s say we’ve come to our script wanting to extract the code to produce one of the results <code>fit.sqrt.A</code>, which is an analysis that is relevant to some product. Not only do we want to double check the results, we also want to use the code again for another purpose, such as creating a plot of the patterns supported by the test.</p>
<p>Manually tracing through our code for all the variables used in the test and finding all of the lines that were used to prepare them for the analysis would be annoying and difficult, especially given the fact that we have used “x” as a prefix for multiple unrelated objects in the script. Instead, we can easily do this automatically with <em>Rclean</em>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/clean.html">clean</a></span><span class="op">(</span><span class="va">script.long</span>, <span class="st">"fit_sqrt_A"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Could not use colored = TRUE, as the package prettycode is not
## installed. Please install it if you want to see colored output or see `?
## print.vertical` for more information.</code></pre>
<pre><code>## x &lt;- 1:100
## x &lt;- log(x)
## x &lt;- x * 2
## x &lt;- lapply(x, rep, times = 4)
## x &lt;- do.call(cbind, x)
## x &lt;- x * 2
## colnames(x) &lt;- paste0("X", seq_len(ncol(x)))
## rownames(x) &lt;- LETTERS[seq_len(nrow(x))]
## x &lt;- t(x)
## x[, "A"] &lt;- sqrt(x[, "A"])
## for (i in seq_along(colnames(x))) {
##   set.seed(17)
##   x[, i] &lt;- x[, i] + runif(length(x[, i]), -1, 1)
## }
## x[, 1] &lt;- x[, 1] * 2 + 10
## x[, 2] &lt;- x[, 1] + x[, 2]
## x[, "A"] &lt;- x[, "A"] * 2
## x &lt;- data.frame(x)
## fit_sqrt_A &lt;- lm(I(sqrt(A)) ~ B, data = x)</code></pre>
<p>As you can see, <em>Rclean</em> has picked through the tangled bits of code and found the minimal set of lines relevant to our object of interest. This code can now be visually inspected to adapt the original code or ported to a new, “refactored” script.</p>
</div>
<div id="behind-the-scenes-how-rclean-works" class="section level1">
<h1 class="hasAnchor">
<a href="#behind-the-scenes-how-rclean-works" class="anchor"></a>Behind the Scenes: How <em>Rclean</em> Works</h1>
<p>The workhorse behind <em>Rclean</em> is data provenance. Here, when we refer to provenance we are talking about a formalized representation of the computational process that produced some data. Data is used in a broad sense, not just data that were collected in a research project. There are multiple approaches to collecting data provenance, but <em>Rclean</em> uses “prospective” provenance, which analyzes code and uses language specific information to predict the relationship among processes and data objects. <em>Rclean</em> relies on a library called <em>CodeDepends</em> to gather the prospective provenance for each script. For more information on the mechanics of the <em>CodeDepends</em> package, see <span class="citation">(Lang 2019)</span>. To get an idea of what data provenance is, take a look at the <code>code_graph</code> function. The plot that it generates is a graphical representation of the prospective provenance generated for <em>Rclean</em>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/code_graph.html">code_graph</a></span><span class="op">(</span><span class="va">script</span><span class="op">)</span></code></pre></div>
<p><img src="Rclean_files/figure-html/prov-graph-1.png" width="700"></p>
<p>Although, a lot of great work can be done with type of data provenance, there are limitations. Only using prospective provenance means that the outcomes of some processes can not be predicted. For example, if there is a part of a script that is determined by a random number, the current implementation of prospective provenance can not predict the path that will be taken through the code. Therefore, the code cannot be reduced to exclude the pathway that would not be taken. Such limitations can be overcome with other data provenance methods. One solution is “retrospective” provenance, which tracks a computational process as it is executing. Through this active monitoring process, retrospective provenance can gather specific information, such as the results relevant to our random number example. Using retrospective provenance comes at a cost, however, in that in order to gather it, the script needs to be executed. When scripts are computationally intensive or contain bugs that stop execution, then retrospective provenance can not be obtained for part or all of the code. The End-to-end Provenance group has implemented methods to use retrospective provenance for R including applications on code cleaning. For more information on this work and using retrospective provenance, go to <a href="http://end-to-end-provenance.github.io" class="uri">http://end-to-end-provenance.github.io</a>.</p>
</div>
<div id="a-comment-about-comments" class="section level1">
<h1 class="hasAnchor">
<a href="#a-comment-about-comments" class="anchor"></a>A Comment about Comments</h1>
<p>Although, there is often very useful or even invaluable information in comments, the <code>clean</code> function removes comments when isolating code. This is primarily due to the lack of a mathematically formal method for determining their relationship to the code itself. Comments at the end of lines are typically relevant to the line they are on, but this is not explicitly required. Also, comments occupying their own lines usually refer to the following lines, but this is also not necessarily the case. As <code>clean</code> depends on the unambiguous determination of relationships in the production of results, it cannot operate automatically on comments. However, comments in the original code remain untouched and can be used to inform the reduced code. Also, as the <code>clean</code> function is oriented toward isolating code based on a specific result, the resulting code tends to naturally support the generation of new comments that are higher level (e.g. “The following produces a plot of the mean response of each treatment group.”), and lower level comments are not necessary because the code is simpler and clearer.</p>
<div id="refs" class="references">
<div id="ref-Lang2019">
<p>Lang, Duncan Temple. 2019. “CodeDepends: Analysis of R code for reproducible research and code view.” <a href="https://github.com/duncantl/CodeDepends">https://github.com/duncantl/CodeDepends</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start bottom-8">
            <div class="col-xs-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-xs-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="http://github.com/ropensci" target="_blank"><div class="icon fab fa-github"></div></a>
                        <a href="http://github.com/ropenscilabs" target="_blank"><div class="icon fa fa-flask"></div></a>
                        <a href="http://twitter.com/ropensci" target="_blank"><div class="icon fab fa-twitter"></div></a>
                        <a href="http://vimeo.com/ropensci" target="_blank"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review">Software Review Process</a></li>
                            <li><a href="https://ropensci.org/about#team">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate">Donate</a></li>
                            <li><a href="https://ropensci.org/contact">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/">Documentation</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" target="_blank">NumFOCUS</a></p>
                        <a href="http://numfocus.org" target="_blank"></a>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '799829e946e1f0f9cd5b5a782c6316b9',
    indexName: 'ropensci-rclean',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
